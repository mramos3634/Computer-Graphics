<!DOCTYPE HTML>
<HTML lang="en">
	<HEAD>
		<META CHARSET="UTF-8">
		<TITLE>TRIANGLE TROUBLE</TITLE>
		<script id="2dVertexShader" type = "notjs">
		attribute vec4 a_position;
		attribute vec3 a_color;
		varying vec3 v_color;
		void main()
		{
			v_color = a_color;
			gl_Position = a_position;
		}
		</script>

		<script id="2dFragmentShader" type="notjs">
		precision mediump float;
		varying vec3 v_color;
		void main()
		{
			gl_FragColor = vec4(v_color,1);
		}
		</script>
		<script>
		//WebGL Setup class
		class InitWebGLProgram {
			constructor() {
				gl.viewport(0,0,gl.canvas.width,gl.canvas.height);
				gl.clearColor(1,1,1,1);
			}
			createShader(type,source) {
				var shader = gl.createShader(type);
				gl.shaderSource(shader,source);
				gl.compileShader(shader);
				return shader;
			}

			createProgram(vs,fs) {
				var program = gl.createProgram();
				gl.attachShader(program,vs);
				gl.attachShader(program,fs);
				gl.linkProgram(program);
				return program;
			}
		}
		
		// shape class
		class Shape {
			constructor() {
			
				//render mode variable (assignment requirement)
				this.mode = 0;
				
				//X     Y    R G B
				var positions = [
				 0.0,  0.5,  1,0,0,
				 1.0,  0.5,  0,1,0,
				 0.5,  1.0,  0,0,1,
				 0.5,  0.0,  1,1,0,
				 0.0, -1.0,  1,0,1,
				-0.5,  0.0,  0,1,1
				];
				
				this.buffer = gl.createBuffer();
				gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);
				gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(positions), gl.STATIC_DRAW);
			}
			
			render(program) {
				var posLoc = gl.getAttribLocation(program, "a_position");
				var colorLoc = gl.getAttribLocation(program, "a_color");

				gl.enableVertexAttribArray(posLoc);
				gl.enableVertexAttribArray(colorLoc);

				gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);

				// position
				gl.vertexAttribPointer(
					posLoc,
					2,
					gl.FLOAT,
					false,
					5*4,
					0
				);
				
				// color
				gl.vertexAttribPointer(
					colorLoc,
					3,
					gl.FLOAT,
					false,
					5*4,
					2*4
				);

				var primitive = gl.TRIANGLES;
				if (this.mode == 1) primitive = gl.TRIANGLE_STRIP;
				if (this.mode == 2) primitive = gl.TRIANGLE_FAN;

				gl.drawArrays(primitive, 0, 6);
			}
		}
		
		//class main
		class main {
			constructor() {
				this.webGL = new InitWebGLProgram();

				var vsSource = document.getElementById("2dVertexShader").text;
				var fsSource = document.getElementById("2dFragmentShader").text;

				var vs = this.webGL.createShader(gl.VERTEX_SHADER, vsSource);
				var fs = this.webGL.createShader(gl.FRAGMENT_SHADER, fsSource);

				this.program = this.webGL.createProgram(vs,fs);
				gl.useProgram(this.program);

				this.shape = new Shape();

				this.draw();
			}
			draw() {
				gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
				this.shape.render(this.program);
			}

			setMode(m) {
				this.shape.mode = m;
				this.draw();
			}
		}
		
		// global variables
		var canvas;
		var gl;
		var mainInstance;
		
		//button callback
		function changeMode(m) {
			mainInstance.setMode(m);
		}
		
		</script>
		
	</HEAD>

	<BODY>

		<CANVAS id="myCanvas" width="640" height="400"></CANVAS>
		<br><br>

		<button onclick="changeMode(0)">TRIANGLES</button>
		<button onclick="changeMode(1)">TRIANGLE_STRIP</button>
		<button onclick="changeMode(2)">TRIANGLE_FAN</button>

		<SCRIPT>
		canvas = document.getElementById("myCanvas");
		gl = canvas.getContext("webgl");
		mainInstance = new main();
		</SCRIPT>

	</BODY>
</HTML>